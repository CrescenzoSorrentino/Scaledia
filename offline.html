<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="description" content="Pagina offline di Scaledia - Accedi ai contenuti anche senza connessione internet">
    <meta name="author" content="Crescenzo Sorrentino">
    <title>Offline - Scaledia</title>

    <!-- Mobile optimization -->
    <meta name="theme-color" content="#007bff">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Scaledia">
    <meta name="format-detection" content="telephone=no">

    <!-- PWA support -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="images/icons/icon-192x192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Inline Critical CSS for faster rendering -->
    <style>
        /* Critical CSS for offline page */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Navigation */
        .navbar {
            padding: 0.5rem 1rem;
        }

        .navbar-brand {
            font-weight: 600;
        }

        .navbar-light .navbar-nav .nav-link {
            color: rgba(0, 0, 0, 0.7);
        }

        /* Main content */
        main {
            flex: 1;
        }

        .offline-container {
            text-align: center;
            padding: 3rem 1rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .offline-icon {
            font-size: 5rem;
            margin-bottom: 2rem;
            color: #6c757d;
        }

        .offline-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
            font-weight: 600;
            border-radius: 50rem;
            margin-bottom: 1rem;
        }

        .status-offline {
            background-color: #f8d7da;
            color: #721c24;
        }

        .status-checking {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-online {
            background-color: #d4edda;
            color: #155724;
        }

        .cached-content {
            margin-top: 3rem;
            text-align: left;
            background-color: #f8f9fa;
            border-radius: 0.25rem;
            padding: 1.5rem;
        }

        .cached-content h3 {
            margin-bottom: 1rem;
            text-align: center;
        }

        .cached-list {
            list-style: none;
            padding: 0;
        }

        .cached-list li {
            padding: 0.75rem 0;
            border-bottom: 1px solid #dee2e6;
        }

        .cached-list li:last-child {
            border-bottom: none;
        }

        .cached-list a {
            color: #007bff;
            text-decoration: none;
            display: block;
        }

        .cached-list a:hover {
            text-decoration: underline;
        }

        .cached-list .page-date {
            font-size: 0.875rem;
            color: #6c757d;
        }

        .no-cache-message {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
        }

        /* Footer */
        footer {
            background-color: #343a40;
            color: #fff;
            padding: 2rem 0;
            margin-top: auto;
        }

        footer a {
            color: #fff;
        }
    </style>

    <!-- Load non-critical CSS asynchronously -->
    <link rel="preload" href="css/bootstrap.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="css/bootstrap.min.css"></noscript>

    <link rel="preload" href="css/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="css/style.css"></noscript>

    <!-- Fallback for browsers that don't support preload -->
    <script>
        !function(n){"use strict";n.loadCSS||(n.loadCSS=function(){});var o=loadCSS.relpreload={};if(o.support=function(){var e;try{e=n.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),o.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.addEventListener?t.removeEventListener("load",a):t.attachEvent&&t.detachEvent("onload",a),t.setAttribute("onload",null),t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},o.poly=function(){if(!o.support())for(var t=n.document.getElementsByTagName("link"),e=0;e<t.length;e++){var a=t[e];"preload"!==a.rel||"style"!==a.getAttribute("as")||a.getAttribute("data-loadcss")||(a.setAttribute("data-loadcss",!0),o.bindMediaToggle(a))}},!o.support()){o.poly();var t=n.setInterval(o.poly,500);n.addEventListener?n.addEventListener("load",function(){o.poly(),n.clearInterval(t)}):n.attachEvent&&n.attachEvent("onload",function(){o.poly(),n.clearInterval(t)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:n.loadCSS=loadCSS}("undefined"!=typeof global?global:this);
    </script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light" aria-label="Navigazione principale">
        <div class="container">
            <a class="navbar-brand" href="index.html">Scaledia</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto" role="menubar">
                    <li class="nav-item" role="none">
                        <a class="nav-link" href="index.html" role="menuitem">Home</a>
                    </li>
                    <li class="nav-item" role="none">
                        <a class="nav-link" href="blog.html" role="menuitem">Blog</a>
                    </li>
                    <li class="nav-item" role="none">
                        <a class="nav-link" href="servizi.html" role="menuitem">Servizi</a>
                    </li>
                    <li class="nav-item" role="none">
                        <a class="nav-link" href="chi-siamo.html" role="menuitem">Chi Siamo</a>
                    </li>
                    <li class="nav-item" role="none">
                        <a class="nav-link" href="contatti.html" role="menuitem">Contatti</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main>
        <div class="container">
            <div class="offline-container">
                <div class="offline-status status-offline" id="connection-status">Offline</div>
                <div class="offline-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M10.706 3.294A12.545 12.545 0 0 0 8 3C5.259 3 2.723 3.882.663 5.379a.485.485 0 0 0-.048.736.518.518 0 0 0 .668.05A11.448 11.448 0 0 1 8 4c.63 0 1.249.05 1.852.148l.854-.854zM8 6c-1.905 0-3.68.56-5.166 1.526a.48.48 0 0 0-.063.745.525.525 0 0 0 .652.065 8.448 8.448 0 0 1 3.51-1.27L8 6zm2.596 1.404.785-.785c.63.24 1.227.545 1.785.907a.482.482 0 0 1 .063.745.525.525 0 0 1-.652.065 8.462 8.462 0 0 0-1.98-.932zM8 10l.933-.933a6.455 6.455 0 0 1 2.013.637c.285.145.326.524.1.75l-.015.015a.532.532 0 0 1-.611.09A5.478 5.478 0 0 0 8 10zm4.905-4.905.747-.747c.59.3 1.153.645 1.685 1.03a.485.485 0 0 1 .047.737.518.518 0 0 1-.668.05 11.493 11.493 0 0 0-1.811-1.07zM9.02 11.78c.238.14.236.464.04.66l-.707.706a.5.5 0 0 1-.707 0l-.707-.707c-.195-.195-.197-.518.04-.66A1.99 1.99 0 0 1 8 11.5c.374 0 .723.102 1.021.28zm4.355-9.905a.53.53 0 0 1 .75.75l-10.75 10.75a.53.53 0 0 1-.75-.75l10.75-10.75z"/>
                    </svg>
                </div>
                <h1>Sei offline</h1>
                <p class="lead">Sembra che tu sia offline. Controlla la tua connessione internet e riprova.</p>
                <p>Non preoccuparti, puoi comunque accedere ai contenuti che hai visitato in precedenza.</p>

                <div class="d-flex justify-content-center mt-3 mb-4">
                    <button id="check-connection" class="btn btn-outline-primary me-2">Verifica connessione</button>
                    <a href="index.html" class="btn btn-primary">Torna alla Home</a>
                </div>

                <div class="cached-content">
                    <h3>Contenuti disponibili offline</h3>
                    <div id="cached-pages-container">
                        <p class="text-center">Caricamento dei contenuti disponibili offline...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5>Scaledia</h5>
                    <p>Soluzioni Digitali Innovative per la tua azienda. Specializzati in SEO, web design e marketing digitale.</p>
                </div>
                <div class="col-md-4">
                    <h5>Link Utili</h5>
                    <ul class="list-unstyled">
                        <li><a href="index.html" class="text-white">Home</a></li>
                        <li><a href="blog.html" class="text-white">Blog</a></li>
                        <li><a href="servizi.html" class="text-white">Servizi</a></li>
                        <li><a href="chi-siamo.html" class="text-white">Chi Siamo</a></li>
                        <li><a href="contatti.html" class="text-white">Contatti</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Contatti</h5>
                    <address>
                        <p>Email: <a href="mailto:info@scaledia.net" class="text-white">info@scaledia.net</a></p>
                        <p>Telefono: <a href="tel:+390123456789" class="text-white">+39 01 2345 6789</a></p>
                        <p>Indirizzo: Via dell'Innovazione 42, Milano</p>
                    </address>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col-md-6">
                    <p>&copy; 2024 Scaledia.net. Tutti i diritti riservati.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <ul class="list-inline">
                        <li class="list-inline-item"><a href="privacy-policy.html" class="text-white" aria-label="Leggi la nostra Privacy Policy">Privacy Policy</a></li>
                        <li class="list-inline-item"><a href="cookie-policy.html" class="text-white" aria-label="Leggi la nostra Cookie Policy">Cookie Policy</a></li>
                        <li class="list-inline-item"><a href="termini-condizioni.html" class="text-white" aria-label="Leggi i nostri Termini e Condizioni">Termini e Condizioni</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <script src="js/bootstrap.bundle.min.js"></script>
    <script>
        // Check connection status
        const connectionStatus = document.getElementById('connection-status');
        const checkConnectionBtn = document.getElementById('check-connection');
        const cachedPagesContainer = document.getElementById('cached-pages-container');

        // Function to check connection status
        function checkConnection() {
            connectionStatus.textContent = 'Verifica in corso...';
            connectionStatus.className = 'offline-status status-checking';

            fetch('https://scaledia.net/ping.json', { 
                method: 'GET',
                cache: 'no-store',
                headers: { 'Cache-Control': 'no-cache' }
            })
            .then(response => {
                connectionStatus.textContent = 'Online';
                connectionStatus.className = 'offline-status status-online';
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            })
            .catch(error => {
                connectionStatus.textContent = 'Offline';
                connectionStatus.className = 'offline-status status-offline';
            });
        }

        // Add event listener to check connection button
        checkConnectionBtn.addEventListener('click', checkConnection);

        // Function to display cached pages
        function displayCachedPages() {
            if ('caches' in window) {
                caches.open('scaledia-v1').then(cache => {
                    cache.keys().then(requests => {
                        if (requests.length === 0) {
                            cachedPagesContainer.innerHTML = `
                                <div class="no-cache-message">
                                    <p>Nessun contenuto disponibile offline.</p>
                                    <p>Visita alcune pagine quando sei online per renderle disponibili offline.</p>
                                </div>
                            `;
                            return;
                        }

                        // Filter out non-HTML requests and sort by URL
                        const htmlRequests = requests.filter(request => {
                            const url = new URL(request.url);
                            return url.pathname.endsWith('.html') || url.pathname.endsWith('/');
                        }).sort((a, b) => a.url.localeCompare(b.url));

                        if (htmlRequests.length === 0) {
                            cachedPagesContainer.innerHTML = `
                                <div class="no-cache-message">
                                    <p>Nessuna pagina disponibile offline.</p>
                                    <p>Visita alcune pagine quando sei online per renderle disponibili offline.</p>
                                </div>
                            `;
                            return;
                        }

                        // Create list of cached pages
                        let html = '<ul class="cached-list">';
                        htmlRequests.forEach(request => {
                            const url = new URL(request.url);
                            let title = url.pathname;

                            // Try to make the title more readable
                            if (title === '/' || title === '/index.html') {
                                title = 'Home';
                            } else {
                                // Remove .html extension and leading slash
                                title = title.replace(/\.html$/, '').replace(/^\//, '');
                                // Convert dashes to spaces and capitalize
                                title = title.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                            }

                            html += `
                                <li>
                                    <a href="${url.pathname}">
                                        ${title}
                                        <span class="page-date">Ultima visita: ${new Date().toLocaleDateString()}</span>
                                    </a>
                                </li>
                            `;
                        });
                        html += '</ul>';

                        cachedPagesContainer.innerHTML = html;
                    });
                });
            } else {
                cachedPagesContainer.innerHTML = `
                    <div class="no-cache-message">
                        <p>Il tuo browser non supporta la cache offline.</p>
                        <p>Prova ad utilizzare un browser più recente per accedere ai contenuti offline.</p>
                    </div>
                `;
            }
        }

        // Display cached pages when the page loads
        document.addEventListener('DOMContentLoaded', displayCachedPages);
    </script>
</body>
</html>
